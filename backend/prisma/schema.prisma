generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
  MEMBER_FREE
  MEMBER_GOLD
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  TRIALING
  INCOMPLETE
  INCOMPLETE_EXPIRED
  UNPAID
}

enum ContactStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum ContactCategory {
  PERFORMANCE_REQUEST
  FAN_CLUB
  MEDIA
  OTHER
}

model User {
  id               String         @id @default(uuid())
  email            String         @unique
  password         String?        // Nullable for OAuth users
  name             String?
  role             Role           @default(USER)
  avatarUrl        String?
  googleId         String?        @unique // Google OAuth ID
  stripeCustomerId String?        @unique // Stripe Customer ID
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  posts            Post[]
  subscriptions    Subscription[]
  contacts         Contact[]
}

model Post {
  id            String   @id @default(uuid())
  title         String
  content       String   @db.Text
  excerpt       String?  // 抜粋
  category      String?
  tags          String[] // タグ配列
  thumbnailUrl  String?  // サムネイル画像
  published     Boolean  @default(false)
  membersOnly   Boolean  @default(false) // 会員限定フラグ
  requiredRole  Role?    // 必要な会員レベル
  authorId      String
  author        User     @relation(fields: [authorId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([published, membersOnly])
  @@index([category])
}

model Concert {
  id          String   @id @default(uuid())
  title       String
  date        DateTime
  venue       String
  location    String?  // 詳細な場所情報
  program     String?  @db.Text // プログラム詳細
  description String?  @db.Text
  imageUrl    String?  // コンサート画像
  ticketUrl   String?
  price       String?  // 料金情報
  isArchived  Boolean  @default(false) // アーカイブフラグ
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date, isArchived])
}

model Discography {
  id          String   @id @default(uuid())
  title       String
  titleEn     String?  // 英語タイトル
  releaseDate DateTime
  label       String?
  trackList   String   @db.Text // JSON format
  description String?  @db.Text
  coverImage  String?
  purchaseUrl String?
  spotifyUrl  String?  // Spotify リンク
  appleMusicUrl String? // Apple Music リンク
  youtubeUrl  String?  // YouTube リンク
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([releaseDate])
}

model Biography {
  id          String   @id @default(uuid())
  language    String   @default("ja") // 'ja' or 'en'
  content     String   @db.Text // プロフィール本文
  summary     String?  @db.Text // 概要
  photoUrls   String[] // 宣材写真のURL配列
  awards      String?  @db.Text // 受賞歴
  education   String?  @db.Text // 学歴
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([language])
}

model History {
  id          String   @id @default(uuid())
  year        Int      // 年度
  date        DateTime? // 具体的な日付（任意）
  title       String   // イベントタイトル
  description String   @db.Text // 詳細説明
  venue       String?  // 会場
  category    String?  // カテゴリ（リサイタル、コンクール、受賞など）
  imageUrl    String?  // 関連画像
  reviews     String?  @db.Text // レビュー・批評
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([year])
}

model Contact {
  id          String          @id @default(uuid())
  name        String
  email       String
  phone       String?
  category    ContactCategory
  subject     String
  message     String          @db.Text
  status      ContactStatus   @default(PENDING)
  userId      String?         // ログインユーザーの場合
  user        User?           @relation(fields: [userId], references: [id])
  adminNote   String?         @db.Text // 管理者メモ
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([status, createdAt])
}

model Subscription {
  id                   String             @id @default(uuid())
  userId               String
  user                 User               @relation(fields: [userId], references: [id])
  stripeSubscriptionId String?            @unique // Stripe Subscription ID
  stripePriceId        String?            // Stripe Price ID
  status               SubscriptionStatus @default(ACTIVE)
  tier                 Role               @default(MEMBER_FREE) // MEMBER_FREE or MEMBER_GOLD
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  cancelAtPeriodEnd    Boolean            @default(false)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt

  @@index([userId, status])
}

model MemberContent {
  id           String   @id @default(uuid())
  title        String
  content      String   @db.Text
  contentType  String   // 'article', 'video', 'audio', 'image'
  thumbnailUrl String?
  fileUrl      String?  // 動画・音声ファイルのURL
  requiredRole Role     @default(MEMBER_FREE) // アクセスに必要な会員レベル
  published    Boolean  @default(false)
  publishedAt  DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([published, requiredRole])
}
